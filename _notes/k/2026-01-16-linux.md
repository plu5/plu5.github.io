---
layout: post
title:  "Notes Linux"
date:   2026-01-16 22:01
modified_date: 2026-01-16 22:01
categories: os
lang: fr
---

## Basique mais j'oublie
- `pwd` : chemin actuel
- `df` : utilisation d'espace disque
- `du -hd0 mondossier` : poids d'un dossier ou fichier
  <br>(`-h` : human readable. `-d0` : depth 0, pareil à `-s` `--summarize`.)
   + `poids=$(du -kd0 "$nom" | cut -f 1)` : si besoin d'avoir juste un chiffre, par ex. pour un script 
     <br>(`-k` : block size 1K, c-à-d kilobits.)
- Trouver un processus
  + `pgrep -x monprocessus` : pid d'un processus par nom exact
  + `ps aux | grep [m]onprocessus` : plus d'informations (cf les titres de colonnes `ps aux | head -n1`), possibilité de chercher par commande (possible aussi avec pgrep en utilisant `-af`)
    <br>les crochets autour de la première caractère permettent d'éviter de trouver le processus du grep aussi.
- `pkill monprocessus` : tuer gentillement
### Pipes
- `.. | head -n1` : première ligne
- `.. | tail -n1` : dernière ligne
- `.. | less` : pager (permet de naviguer et chercher la sortie)
  + <kbd>/</kbd> : chercher
- `.. | awk '{print $1}'` : extraire une donnée dans position 1 quand tu as une ligne de sortie avec des données séparées par espace ou tab (avec plusieurs lignes ça extrait la donnée en position 1 de chacune)

## Débogage
- `coredumpctl list --no-pager` : liste de crashs. même si la génération de coredumps est désactivée.
  <br>l'affichage dépend de la taille de la fenêtre alors je mets mon terminal en plein écran avant.
### Xorg
- Les logs pour une session non-root se trouve dans `~/.local/share/xorg`. Si X est en cours, `Xorg.0.log` est le log de la session actuelle, et `Xorg.0.log.old` de la précédente.
  <br>Ou un autre numéro au lieu de 0 ; [ArchWiki](https://wiki.archlinux.org/title/Xorg) : «The logfiles are of the form Xorg.n.log with n being the display number.»
- Il y a aussi la sortie stdout et stderr à considérer. Certaines distributions la mettent dans `~/.xsession-errors`. La plupart des messages qui y apparaissent figurent également dans le log Xorg. Ce qui est important de vérifier est le début et la fin.
  <br>`startx > ~/.xsession-errors 2>&1`

## Gestion des processus
- pkill onedrive
- pstree | grep onedrive

## Fichiers
- Commande pour lister les fichiers avec date de création et modification, triés par création (birth) :
  ```bash
  alias lshorodatage='shopt -s dotglob && stat * --format "%.16w %.16y %n" | sort -n'
  ```

## Termes
- seat : TODO. qqch à voir avec VTs et qu'est-ce qui peut utiliser un tel ou tel VT ?
### Pas spécifique à Linux
- PAM : gestion des accès privilégiés (Privileged Access Management)

## Recettes
### Utilisateur
#### Faire fonctionner le bouton d'alimentation
1. `sudo nano /etc/systemd/logind.conf`
2. Décommenter `HandlePowerKey=poweroff`
   - <kbd>Ctrl F</kbd> HandlePowerKey
   - Supprimer le `#` au début de la ligne
3. Sauvegarder (<kbd>Ctrl O</kbd>)

Le bouton d'alimentation n'est pas traité sur Arch Linux par défaut et il est important de le configurer, car un arrêt brutal peut corrompre des données. Ça arrive de devoir appuyer sur le bouton à cause d'un blocage autrement irrécupérable.

C'est systemd qui le gère.

Dans `/etc/systemd/logind.conf` tout est commenté par défaut. Décommente `HandlePowerKey=poweroff`. Tu y peux aussi configurer ce qui arrive avec d'autres boutons de contrôle système (Reboot, Suspend, Hibernate) et LidSwitch.

cf [ArchWiki : Power managemnt : ACPI events](https://wiki.archlinux.org/title/Power_management#ACPI_events)
#### Déplacer une fenêtre avec précision
```bash
# la fenêtre active
xdotool getwindowfocus windowmove 635 339
# ou :
wmctrl -r :ACTIVE: -e 0,500,500,-1,-1
# (les -1 veulent dire ne pas changer la taille)

# fenêtre par classe ou nom, où Peek est le nom de ma fenêtre
xdotool search --class Peek windowmove %@ 635 339 windowsize %@ 657 377
# ou :
wmctrl -r Peek -e 0,635,339,657,377

# liste des fenêtres avec IDs, classes, titres
wmctrl -lx
```
et avec `-lG` il y a aussi la géometrie de fenêtres, mais ce n'est pas exactes sous bspwm, cf [bspwm: La position d'une fenêtre](#la-position-dune-fenêtre)
#### Symlink
Voici quelques symlinks que j'utiliser pour pouvoir syncer facilement des données importantes avec [onedrive](https://github.com/abraunegg/onedrive) :
``` bash
# Dossier Dropbox sur un dual boot (changes nom d'utilisateur `pm`)
sudo ln -s /media/Windows/Users/pm/Dropbox/Apps ~/OneDrive/pnotes

# Backups de favoris firefox (change le chemin avec ton propre que tu peux voir dans `about:profiles` sur firefox)
sudo ln -s /home/pm/.mozilla/firefox/4afxl8gu.default-release/bookmarkbackups/ ~/OneDrive/backups/bookmarkbackups

# Site, pour ne pas perdre des changements en cours
sudo ln -s /media/Windows/Users/pm/dev/reps/plu5.github.io ~/OneDrive/backups/reps/plu5.github.io
```

> [!NOTE]
> Je garde pas mal de mes données sur une partition ntfs pour pouvoir les accéder depuis n'importe quel système d'exploitation, car Linux supporte ntfs mais Windows ne supporte pas ext4.
>
> Il faut aussi noter que ça pourrait arriver qu'un dossier créé sous Windows ne soit pas accessible sous Linux. Ça arrive quand il y a une étiquette particulière [TODO: écrire davantage, cf log 4e]. ça m'a arrivé avec mon dossier Dropbox après une mise à jour de ce dernier. Ma solution était de déconnecter et réconnecter et le laisser renommer le dossier et en créer un nouveau, puis quitter avant que ça ne sync, déplacer le contenu du vieux dossier dans le nouveau, et relancer. Il se rend compte assez rapidement que tout est là et revient en mode veille. Il y a aussi un plugin pour pouvoir accéder des dossiers avec cette étiquette quand même [TODO mettre un lien] mais il n'est pas maintenu.
### bspwm
#### La position d'une fenêtre
flottante :
```bash
# où "Peek" est le nom de ma fenêtre
wid=$(wmctrl -l | grep Peek | awk '{print $1}'); bspc query --node $wid --tree | jq .client.floatingRectangle
```
si non flottante, juste `.rectangle`
### Script
#### Faire quelque chose seulement si l'utilisateur a la commande
``` bash
has_paplay=$(command -v paplay >/dev/null 2>&1 && echo true)
[ $has_paplay = true ] && paplay "/usr/share/sounds/freedesktop/stereo/complete.oga"
```

{% include fin.html %}
